name: Verify

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  verify-library:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v3
      with:
        python-version: '3.x'

    - name: Install Online Judge Tools
      run: |
        pip install online-judge-tools
        pip install online-judge-verify-helper

    - name: Get list of changed files
      id: changes
      run: |
        echo "$(git diff --name-only HEAD~1 HEAD)" > changed_files.txt

    - name: Run oj-verify on .test.cpp files
      run: |
        files=$(cat changed_files.txt)
        for file in $files; do
          if [[ $file == *.test.cpp ]]; then
            oj-verify run $file
          fi
        done